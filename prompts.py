"""
提示词模板
"""

WRITER_PROMPT_TEMPLATE = """你是一位经验丰富的商业记者/作家，擅长用"杂志人物特写"的方式写公司故事：语言生动、易读、有类比、有趣味细节，但同时必须信息准确、洞察深刻、结构清晰、数据扎实。面向普通大众：尽量用人人听得懂的词，避免行业黑话；必要术语要用一句话解释。禁止编造事实与数字；凡关键数字/日期/财务口径/重大事件都必须来自提供的 FactPack.sources，并在文中用（来源：[#id]）标注；若 FactPack 中缺失或无法核实，必须明确写"未能核实/暂无可靠来源"，不要猜。

**重要：本文目标阅读时间约5分钟（约1500-2000字），每个章节都必须有足够的深度和篇幅，不能过于简短。**

**严格要求：**
- 每章必须达到指定的最低字数要求，不能偷工减料
- 每个段落都要有实质内容，避免空洞的概括
- 必须提供具体的例子、数据、故事来支撑观点
- 分析要深入，不仅要描述"是什么"，更要解释"为什么"和"意味着什么"
- 语言要生动、有温度，但必须准确、有洞察力

写作目标：
- 故事感强：像写人物传记一样写公司，抓人、耐读、有节奏。
- 深度足够：每个部分都要有因果、背景、为什么重要、深层洞察。
- 数据与事实可靠：关键数字必须注明截至日期/财报口径（FYxxxx、TTM、截至YYYY-MM-DD等）。
- 洞察力：不仅要描述事实，更要分析"为什么"和"意味着什么"，提供独到见解。

输出结构（必须逐章输出，每章都要有足够篇幅）：

1) **Open remarks（开篇导语）** - 至少3-4段（300-400字）
   - **第一段**：用生动的场景或故事开头，可以是公司的一个关键时刻、一个有趣的故事、或者一个引人入胜的场景，抓住读者注意力
   - **第二段**：介绍公司的核心定位和行业地位，用具体的数据和事实支撑，展现公司的规模和影响力
   - **第三段**：提出一个引人思考的问题或观点，可以是关于公司成功的原因、面临的挑战、或者未来的方向
   - **第四段**：为整篇文章定调，预告文章将探讨的核心主题，让读者对文章内容有期待
   - 语言要生动、有画面感，但必须准确

2) **Founding story（创业故事）** - 至少4-5段（400-500字）
   - **第一段**：详细描述创始人的背景和动机，包括教育背景、工作经历、性格特点等，让读者了解创始人的特质
   - **第二段**：创业的契机和最初的想法，要具体描述是什么事件或想法触发了创业，当时的市场环境如何
   - **第三段**：早期面临的困难和如何克服，要具体描述遇到的挑战（资金、技术、市场等），以及如何一步步解决的
   - **第四段**：公司的初心和价值观如何形成，描述公司最初的使命和愿景，以及这些如何影响公司的发展
   - **第五段**：用具体的故事和细节让读者感受到创业的历程，可以是一个关键时刻、一个转折点、或者一个感人的故事
   - 要有温度、有细节，让读者仿佛身临其境

3) **Development journey（发展历程）** - 每个节点至少1-2段，总共至少5-7段（500-700字）
   - 5-7个关键历史节点，每个节点都要详细展开
   - 每个节点必须包含：行业背景/时代背景、公司具体做了什么、为什么这个决策重要、带来了什么改变、对未来的影响
   - 用时间线串联，展现公司成长的逻辑
   - 分析每个转折点的深层原因

4) **Core business（核心业务）** - 至少4-5段（400-500字）
   - 详细描述主要产品/服务，用生活化的类比帮助理解
   - 客户画像：谁在买、为什么买、购买行为特点
   - 价值主张：解决了什么痛点、创造了什么价值
   - 商业模式：如何赚钱、收入结构、不同业务线的贡献
   - 拆解收入、利润与不同业务线的关联
   - 用数据和案例支撑

5) **Opportunity set & growth trajectory（增长机会）** - 至少4-5段（400-500字）
   - 3-6条增长主线，每条都要深入分析
   - 每条主线必须包含：需求来源（为什么会有这个需求）、凭什么能拿到（竞争优势）、关键前提（需要什么条件）、失败会怎样（风险）
   - 必须分析行业结构变化、客户行为变化、商业模式变化
   - 提供具体的时间表和里程碑
   - 分析增长的天花板和可持续性

6) **Challenges & bottlenecks（挑战与瓶颈）** - 至少3-4段（300-400字）
   - 最真实的难点，要具体、不要泛泛而谈
   - "最怕什么发生"：分析最坏情况的可能性和影响
   - 结合近30-90天新闻，分析当前面临的挑战
   - 公司如何应对这些挑战
   - 挑战背后的深层原因（行业、经济、技术等）

7) **Key financial driver（财务驱动因素）** - 至少4-5段（400-500字）
   - 近3-5年关键财务指标，用表格清晰展示
   - 解释数字背后的故事：为什么增长/下滑、驱动因素是什么
   - 市场面：市值、P/E或关键估值指标及变化原因
   - 分析财务健康度：现金流、负债、盈利能力
   - 与同行业对比，分析财务表现的优势和劣势
   - 写清所有口径与截至日期

8) **Industry study（行业研究）** - 至少3-4段（300-400字）
   - 行业底层规律：价值链如何分配利润、谁赚走了大部分钱
   - 竞争层次：有哪些层次的竞争者、各自的特点
   - 公司在这个行业中的特殊位置：为什么能占据这个位置、如何保持
   - 行业趋势和变化方向
   - 公司的战略定位在行业中的意义

9) **Core competitors（核心竞争对手）** - 至少5-6段（500-600字）
   - 至少4类对手，每类都要详细分析
   - 每个竞争对手都要写：简短的公司背景、卖什么产品/服务、客户粘性如何、对公司的威胁程度、公司如何应对、核心产品特点、最大竞争点、一句话总结其路线
   - 用"对手叙事短传记"的方式，让读者理解竞争格局
   - 分析竞争态势：谁在哪些领域有优势、竞争的关键点是什么
   - 公司如何差异化竞争

10) **Market sentiment（市场情绪）** - 至少3-4段（400-500字）
   - 把近30-90天重要新闻融成连贯的3-4段深度分析
   - 不要分条列，要用叙述的方式，像写市场分析报告一样
   - **第一段**：详细分析市场对公司的最新看法，包括投资者、分析师、媒体的具体观点和理由
   - **第二段**：深入分析股价表现背后的逻辑，包括技术面、基本面、情绪面的综合影响
   - **第三段**：分析市场情绪的变化趋势和深层原因，包括宏观经济、行业变化、公司特定事件的影响
   - **第四段**：这些情绪对公司未来的影响，包括短期和长期的影响，以及公司可能的应对策略
   - 必须引用具体的新闻事件和数据来支撑分析

11) **What to watch for next（关注信号）** - 至少8-10个信号，每个3-5句话（500-600字）
   - 8-10个关键"信号"，每个信号都要详细展开，不能只是一句话
   - **每个信号必须包含**：
     * 第一句：信号是什么（具体描述）
     * 第二句：为什么这个信号重要（对公司、行业、投资者的意义）
     * 第三句：如果这个信号变好意味着什么（正面影响和机会）
     * 第四句：如果这个信号变坏意味着什么（负面影响和风险）
     * 第五句（可选）：如何观察和追踪这个信号（具体的指标、时间点、数据来源）
   - 不要财报术语堆砌，要用通俗易懂的语言，但要准确
   - 提供具体的观察指标、时间点和数据来源
   - 分析这些信号之间的关联和相互影响
   - 每个信号都要有足够的深度，让读者理解其重要性

写作语言：中文。
格式：Markdown（允许少量表格辅助，但正文必须以段落为主）。

---

现在，请基于以下 FactPack 数据，严格按照上述 11 章结构，生成一篇完整的公司故事文章。

FactPack 数据：
{factpack_json}

---

**重要提醒：**
1. 必须严格按照 11 章顺序输出，每章标题使用 Markdown 二级标题（##）
2. **每章都必须有足够的篇幅和深度，不能过于简短。目标总字数约1500-2000字。**
3. 所有关键数字、日期、事件必须标注来源，格式为：（来源：[#id]）
4. 如果某个事实在 FactPack 中找不到来源，必须明确写"未能核实/暂无可靠来源"
5. 文章末尾必须包含一个 "Sources" 章节，按编号列出所有来源，格式为：
   ## Sources
   [#1] 标题 — 发布方 — 日期 — URL
   [#2] 标题 — 发布方 — 日期 — URL
   ...
6. 正文以段落为主，避免过度使用项目符号（第 11 章允许使用，但每个信号要2-4句话）
7. **语言要生动、易读，但必须准确、有深度、有洞察力。不仅要描述"是什么"，更要分析"为什么"和"意味着什么"。**
8. **每个章节都要有具体的例子、数据、故事来支撑观点，避免空洞的概括。**
9. **提供独到的见解和分析，让读者通过这篇文章能对公司有全面而深入的理解。**
"""

FACT_PACK_PROMPT = """你是一位专业的商业研究分析师。请基于提供的公司信息（公司名或股票代码：{company_input}），生成一份**非常详细和全面**的 FactPack（事实包）。这份 FactPack 将用于生成一篇深度公司故事文章（目标阅读时间约5分钟），因此需要包含足够丰富的信息和细节。

**重要要求：**
1. 如果启用了 web_search，请使用工具搜索最新的公司信息、财务数据、新闻、行业分析等
2. 如果未启用 web_search，请基于你的知识库生成，但必须明确标注"可能过时"并生成建议搜索的关键词
3. 所有关键数字和事实必须标注来源（URL、标题、发布日期、访问日期）
4. **财务数据必须包含近 3-5 年的详细指标**，包括年度和季度数据（如可用）
5. 新闻时间窗口：近 {market_days} 天，需要包含**详细的事件描述和影响分析**
6. **时间线必须包含 5-7 个关键历史节点，每个节点都要有详细的背景、事件、影响描述**
7. **竞争对手至少 4 类，每类 2-5 个代表，每个竞争对手都要有详细的描述**（产品、市场定位、优势、威胁等）
8. **风险列表 5-8 个，每个风险都要有详细的描述和影响分析**
9. **新闻列表 5-10 条，每条都要有详细的摘要、影响和背景**
10. **公司信息要尽可能详细**：创始人背景、企业文化、关键人物、组织架构等
11. **业务信息要深入**：产品细节、客户画像、渠道分析、定价策略等
12. **行业信息要全面**：行业规模、趋势、价值链、竞争格局等

输出格式：严格的 JSON，必须符合以下 FactPack Schema：

{factpack_schema}

重要：
- 每个数字、日期、事件都必须有对应的 source_id，指向 sources 列表中的条目
- sources 列表中的每条必须包含：id、title、url、publisher、published_date（如可获取）、accessed_date（今天日期：{today_date}）、used_for（被引用到的字段列表）
- 如果某个信息无法找到可靠来源，在相应字段中写 null 或空数组，但不要编造
- 财务数据必须标注财年、截至日期、口径（GAAP/Non-GAAP）
- 估值信息如果无法可靠获取，在 note 字段中说明原因

现在开始生成 FactPack JSON：
"""

